package com.ftbap.ftbap;

import dev.ftb.mods.ftbquests.events.CustomTaskEvent;
import dev.ftb.mods.ftbquests.quest.Quest;
import net.minecraft.entity.player.EntityPlayerMP;
import net.minecraftforge.fml.common.eventhandler.EventPriority;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

public class QuestCompletionListener {
    private final ArchipelagoClient archipelagoClient;
    private final ArchipelagoRewardManager rewardManager;

    public QuestCompletionListener(ArchipelagoClient archipelagoClient, ArchipelagoRewardManager rewardManager) {
        this.archipelagoClient = archipelagoClient;
        this.rewardManager = rewardManager;
    }

    @SubscribeEvent(priority = EventPriority.HIGHEST)
    public void onQuestCompleted(CustomTaskEvent.Completed event) {
        Quest quest = event.getTask().getQuest();
        String questTitle = quest.getTitle();
        EntityPlayerMP player = event.getPlayer();

        if (rewardManager.shouldPreventNormalReward(quest, player)) {
            event.setCanceled(true); // Prevent normal reward distribution
            archipelagoClient.sendLocationChecks(questTitle);
        }
    }
}